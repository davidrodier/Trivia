create or replace PACKAGE GESTIONJEU AS

FUNCTION SELECTQUESTIONSCATEGORY (CATEGORIE IN QUESTION.CODECAT%TYPE) RETURN SYS_REFCURSOR;
FUNCTION SELECTBONNEREPONSE (NUMERODEQUESTION IN NUMBER) RETURN SYS_REFCURSOR;
FUNCTION SELECTQUESTIONNUMERO (NUMERO IN NUMBER) RETURN SYS_REFCURSOR;

PROCEDURE DELETEQUESTION
(
  IN_CODEQUES IN QUESTION.CODEQUESTIONS%TYPE,
  IN_QUESTION IN QUESTION.QUESTION%TYPE,
  IN_REPONSE1 IN REPONSE.REPONSEMAUVAISE1%TYPE,
  IN_REPONSE2 IN REPONSE.REPONSEMAUVAISE2%TYPE,
  IN_REPONSE3 IN REPONSE.REPONSEMAUVAISE3%TYPE,
  IN_REPONSE4 IN REPONSE.REPONSEBONNE%TYPE
);
PROCEDURE INSERTQUESTION
(
  IN_CATEGORY IN QUESTION.CODECAT%TYPE,
  IN_QUESTION IN QUESTION.QUESTION%TYPE,
  IN_REPONSE1 IN REPONSE.REPONSEMAUVAISE1%TYPE,
  IN_REPONSE2 IN REPONSE.REPONSEMAUVAISE2%TYPE,
  IN_REPONSE3 IN REPONSE.REPONSEMAUVAISE3%TYPE,
  IN_REPONSE4 IN REPONSE.REPONSEBONNE%TYPE
);
PROCEDURE UPDATEQUESTION
(
  IN_CODEQUES IN QUESTION.CODEQUESTIONS%TYPE,
  IN_QUESTION IN QUESTION.QUESTION%TYPE,
  IN_REPONSE1 IN REPONSE.REPONSEMAUVAISE1%TYPE,
  IN_REPONSE2 IN REPONSE.REPONSEMAUVAISE2%TYPE,
  IN_REPONSE3 IN REPONSE.REPONSEMAUVAISE3%TYPE,
  IN_REPONSE4 IN REPONSE.REPONSEBONNE%TYPE
);
-- Augmente le score de 1 à partir du score qu'il y avait déjà (incrémenteur de score)
PROCEDURE MONTERSCOREJOUEUR
(
  IN_PSEUDO IN SCORE.PSEUDO%TYPE,
  IN_SCORE IN SCORE.SCORE%TYPE
);

-- Met le score à 0 quand une nouvelle partie commence et qu'on reprend pas une partie
PROCEDURE RESETSCORETOZERO
(
  IN_PSEUDO IN SCORE.PSEUDO%TYPE,
  IN_SCORE IN SCORE.SCORE%TYPE
);
END;




create or replace PACKAGE BODY GESTIONJEU AS

FUNCTION SELECTQUESTIONSCATEGORY
(
  CATEGORIE IN QUESTION.CODECAT%TYPE
) RETURN SYS_REFCURSOR AS
RESULTAT SYS_REFCURSOR;
BEGIN
  OPEN RESULTAT FOR SELECT Q.QUESTION FROM QUESTION Q WHERE Q.CODECAT=CATEGORIE;
  RETURN RESULTAT;
END;
FUNCTION SELECTBONNEREPONSE
(
  NUMERODEQUESTION IN NUMBER
) RETURN SYS_REFCURSOR AS
RESULTAT SYS_REFCURSOR;
BEGIN
  OPEN RESULTAT FOR SELECT REPONSEBONNE FROM REPONSE WHERE CODEQUESTIONS=NUMERODEQUESTION;
  RETURN RESULTAT;
END;
FUNCTION SELECTQUESTIONNUMERO
(
  NUMERO IN NUMBER
) RETURN SYS_REFCURSOR AS
RESULTAT SYS_REFCURSOR;
BEGIN
  OPEN RESULTAT FOR SELECT Q.QUESTION, R.REPONSEMAUVAISE1, R.REPONSEMAUVAISE2, R.REPONSEMAUVAISE3, R.REPONSEBONNE FROM QUESTION Q INNER JOIN REPONSE R ON Q.CODEQUESTIONS=R.CODEQUESTIONS WHERE Q.CODEQUESTIONS=NUMERO;
  RETURN RESULTAT;
END;

PROCEDURE DELETEQUESTION
(
  IN_CODEQUES IN QUESTION.CODEQUESTIONS%TYPE,
  IN_QUESTION IN QUESTION.QUESTION%TYPE,
  IN_REPONSE1 IN REPONSE.REPONSEMAUVAISE1%TYPE,
  IN_REPONSE2 IN REPONSE.REPONSEMAUVAISE2%TYPE,
  IN_REPONSE3 IN REPONSE.REPONSEMAUVAISE3%TYPE,
  IN_REPONSE4 IN REPONSE.REPONSEBONNE%TYPE
) AS
BEGIN
  DELETE FROM QUESTION WHERE CODEQUESTIONS=IN_CODEQUES;
  DELETE FROM REPONSE WHERE CODEQUESTIONS=IN_CODEQUES;
  COMMIT;
END;
PROCEDURE INSERTQUESTION
(
  IN_CATEGORY IN QUESTION.CODECAT%TYPE,
  IN_QUESTION IN QUESTION.QUESTION%TYPE,
  IN_REPONSE1 IN REPONSE.REPONSEMAUVAISE1%TYPE,
  IN_REPONSE2 IN REPONSE.REPONSEMAUVAISE2%TYPE,
  IN_REPONSE3 IN REPONSE.REPONSEMAUVAISE3%TYPE,
  IN_REPONSE4 IN REPONSE.REPONSEBONNE%TYPE
) AS
BEGIN
  INSERT INTO QUESTION VALUES(QUESTIONS_SEQ.NEXTVAL, IN_CATEGORY, IN_QUESTION);
  INSERT INTO REPONSE VALUES(QUESTIONS_SEQ.CURRVAL, IN_REPONSE1, IN_REPONSE2, IN_REPONSE3, IN_REPONSE4);
  COMMIT;
END;
PROCEDURE UPDATEQUESTION
(
  IN_CODEQUES IN QUESTION.CODEQUESTIONS%TYPE,
  IN_QUESTION IN QUESTION.QUESTION%TYPE,
  IN_REPONSE1 IN REPONSE.REPONSEMAUVAISE1%TYPE,
  IN_REPONSE2 IN REPONSE.REPONSEMAUVAISE2%TYPE,
  IN_REPONSE3 IN REPONSE.REPONSEMAUVAISE3%TYPE,
  IN_REPONSE4 IN REPONSE.REPONSEBONNE%TYPE
) AS
BEGIN
  UPDATE QUESTION SET QUESTION=IN_QUESTION WHERE CODEQUESTIONS=IN_CODEQUES;
  UPDATE REPONSE SET REPONSEMAUVAISE1=IN_REPONSE1, REPONSEMAUVAISE2=IN_REPONSE2, REPONSEMAUVAISE3=IN_REPONSE3, REPONSEBONNE=IN_REPONSE4 WHERE CODEQUESTIONS=IN_CODEQUES;
  COMMIT;
END;
create or replace PROCEDURE RESETSCORETOZERO 
(
  IN_PSEUDO IN SCORE.PSEUDO%TYPE,
  IN_SCORE IN SCORE.SCORE%TYPE
) AS 
BEGIN
  UPDATE SCORE SET SCORE.SCORE = 0 WHERE PSEUDO=IN_PSEUDO;
END RESETSCORETOZERO;	-- End avec le nom de la fonction. Nécessaire?

create or replace PROCEDURE MONTERSCOREJOUEUR 
(
  IN_PSEUDO IN SCORE.PSEUDO%TYPE,
  IN_SCORE IN SCORE.SCORE%TYPE
) AS 
BEGIN
  UPDATE SCORE SET SCORE.SCORE = (SELECT SCORE FROM SCORE WHERE PSEUDO=IN_PSEUDO)+1 WHERE PSEUDO=IN_PSEUDO;
END MONTERSCOREJOUEUR;	-- End avec le nom de la fonction. Nécessaire?

END;